---
import { Markdown } from "@astropub/md";
import Default from "../../layouts/Default.astro";

export async function getStaticPaths() {
	const headers = new Headers({
		"User-Agent": "spiritgamestudiosstudios/landing, @worldwidepixel or @callmeecho on discord.",
	});
	let spiritProjects;
	try {
		spiritProjects = await (
			await fetch("https://api.modrinth.com/v3/organization/spirit/projects", {
				headers: headers,
			})
		).json();
	} catch {
		return [];
	}
	let paths = [];
	for (const project of spiritProjects) {
		paths.push({ params: { slug: `${project.slug}` } });
	}
	return paths;
}

const headers = new Headers({
	"User-Agent": "spiritgamestudiosstudios/landing, @worldwidepixel or @callmeecho on discord.",
});
let projects;
try {
	projects = await (
		await fetch("https://api.modrinth.com/v3/organization/spirit/projects", {
			headers: headers,
		})
	).json();
} catch {
	Astro.response.status = 404;
	Astro.response.statusText = "Not found";
}
let project;
for (let i = 0; i < projects.length; i++) {
	if (projects[i].slug === Astro.params.slug) {
		project = projects[i];
	}
}

//console.log(project);
const title = project.name;
const desc = project.description;
const icon = project.icon_url;
const summary = project.summary;
const slug = project.slug;
const links = project.link_urls;
let banner;
for (let i = 0; i < project.gallery.length; i++) {
	if (project.gallery[i].featured === true) {
		banner = project.gallery[i].url;
	}
}
---

<Default title={title ?? "Undefined Project"}>
	<div class="flex flex-col gap-4">
		<div class="flex flex-row flex-wrap items-center justify-center gap-2 gap-y-4 sm:justify-between">
			<div class="flex flex-row items-start gap-4">
				<img class="h-20 w-20 flex-none rounded-xl" src={icon ?? "/favicon.svg"} />
				<div class="flex flex-col justify-center">
					<span class="text-4xl font-thin tracking-wider">{(title ?? "undefined").toUpperCase()}</span>
					<span class="text-lg">{summary ?? "undefined summary"}</span>
				</div>
			</div>
			<div class="flex flex-row items-start gap-2">
				<a href={"https://modrinth.com/project/" + slug ?? "undefined"} class="button">Modrinth</a>
				<a href={links.source.url ?? "https://github.com/spiritgamestudios"} class="button">Github</a>
			</div>
		</div>
		<hr />
		<span class="py-2 font-light tracking-widest">DESCRIPTION</span>
		<div class="md">
			<Markdown of={desc} />
		</div>
	</div>
	<img
		src={banner ?? "/favicon.svg"}
		class="bgimg absolute left-0 top-0 z-[-2] h-[25%] w-full object-cover blur-[5vh]"
	/>
</Default>
